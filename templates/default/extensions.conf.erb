
[general]
static=yes
writeprotect=no
clearglobalvars=no

[macro-slaline]
exten => s,1,SLATrunk(${ARG1})
exten => s,n,Goto(s-${SLATRUNK_STATUS},1)
exten => s-FAILURE,1,Voicemail(100,u)
exten => s-UNANSWERED,1,Voicemail(100,u)

[from-skype]
exten => s,1,Macro(slaline,from-skype)
exten => _X.,1,Goto(s,1)

[from-skype_outbound]
exten => disa,1,Disa(no-password,from-skype_outbound)
exten => _1NXXNXXXXXX,1,Dial(SIP/${EXTEN}@skype_connect)
exten => _NXXXXXXX,1,Dial(SIP/+852${EXTEN}@skype_connect)
exten => _9NXXXXXXXX,1,Dial(SIP/+852${EXTEN}@skype_connect)

; test number 1760 660 4690

[sla_stations]
<% @users.each do |user| %>
exten => station<%= user[:extension] %>,1,SLAStation(station<%= user[:extension] %>)
exten => station<%= user[:extension] %>_from-skype,hint,SLA:station<%= user[:extension] %>_from-skype
exten => station<%= user[:extension] %>_from-skype,1,SLAStation(station<%= user[:extension] %>_from-skype)
<% end %>

[globals]
CONSOLE=Console/dsp				; Console interface for demo
IAXINFO=guest					; IAXtel username/password
TRUNK=Zap/G2					; Trunk interface
TRUNKMSD=1					; MSD digits to strip (usually 1 or 0)

[default]
exten => s,1,Set(CALLERID(name)=${DB(cidname/${CALLERID(num)})})
exten => s,n,Dial(SIP/<%= @users[0][:username] %>, 10)
exten => s,n, Hangup
exten => <%= @users[0][:username] %>, 1, Dial(SIP/<%= @users[0][:username] %>, 10)

[outbound]
exten => _+X, 1, Dial(SIP/skype/+${EXTEN},90)

[local-devices]
<% @users.each do |user| %>
exten => <%= user[:extension] %>, 1, Dial(SCCP/<%= user[:extension] %>, 10)
exten => <%= user[:extension] %>, n, VoiceMail(<%= user[:extension] %>@generalsensing.com,u)
<% end %>
